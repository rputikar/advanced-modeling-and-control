---
title: "Other Advanced Control Techniques"
subtitle: In class activities
date: 2023-08-13
format:
  pdf
resources:
   - "./PI_without_gain_scheduler.slx"
   - "./PI_with_gain_scheduler.slx"
   - "./problem_4_1_pure_feedback.slx"
   - "./problem_4_1_smith_predictor.slx"
date-modified: 2025-08-10
---

```{python}
import numpy as np
import matplotlib
import matplotlib.pyplot as plt
import control as ctrl
import scipy as sp
from scipy.optimize import minimize
from scipy import signal
from IPython.display import display, Markdown
plt.style.use('../../../assets/templates/present.mpstyle')
```


## Activities

1. Effect of delay time on controller tuning
   
   Consider a process with following transfer function

   $$
   G_p = \frac{1}{(5 s + 1) (3 s + 1)}
   $${#eq-p1}

   The PI controller for this process has parameters of K~c~ = 3, and τ~I~ = 6.

   What happens to the response when a dead time of θ = 2 is introduced?

   Determine controller parameters to obtain an overshoot similar to the
   process without delay. 

2. Design a Smith predictor for problem 1. 

   Use [problem_4_1_pure_feedback.slx](./problem_4_1_pure_feedback.slx) as a starting point. 

::: {.content-visible when-format="html"}
::: {.callout-tip collapse="true"}
## Solution

   [problem_4_1_pure_feedback.slx](./problem_4_1_pure_feedback.slx). 

   [problem_4_1_smith_predictor](./problem_4_1_smith_predictor.slx). 

:::
:::

{{< pagebreak >}}

3. It is desired to control the size distribution of crystals produced in
   vacuum continuous crystallizer, but it’s very difficult to measure i.e.
   requires lengthy lab test. Some experiment suggest that crystal size
   distribution are strongly related to the (1) stirrer speed q, (2) magma
   temperature T, (3) degree of supersaturation C-Cs, and (4) mother liquor
   density r. C is concentration of the solute and Cs is the solubility of the
   solute.
   
   1. Suggest an inferential control technique for crystal size distribution
   2. Show the schematic of the control strategy. Comment on the effectiveness
      of the strategy.

::: {.content-visible when-format="html"}
::: {.callout-tip collapse="true"}
## Solution

Use an inferential (soft‑sensor) MPC that estimates key crystal size metrics
from easily measured variables, then controls them.

Primary CV: median size $d_{50}$. Additionally, the CoV (coefficient of variance)
of the crystal size distribution (CSD) can also be calculated. 

Build a soft sensor to estimate $d_{50}$ and CoV from $q$ (stirrer speed), $T$
(magma temperature), $S=C-C_s(T)$ (supersaturation), and $\rho$ (mother‑liquor
density). The soft sensor can be built using a data driven model or a
mechanistic first principles model. 

Manipulated variables: 
  * coolant or steam valve that sets temperature, hence $C_s(T)$ and $S$
  * vacuum or condenser duty that sets boiling rate and $T$
  * seed addition rate or seed PSD
  * feed concentration or solvent/antisolvent addition that sets $C$ and $\rho$
  * agitator speed $q$ within mechanical limits

Disturbance variables: feed rate, impurities, mother‑liquor recycle.

Control strategy: 

- Tight PID feedback loops for T, P, and q. 
- MPC is used to adjust the setpoint
- Optionally, a additional control loop on $\rho$ via solvent/ purge flow rate control. 

Limitations:

- Model mismatch
- Sensor quality/ accuracy
- Requires periodic lab data for bias correction

:::
:::


{{< pagebreak >}}

4. Consider two inferential model for the prediction of distillation top
   impurity fraction xD and a tray temperature T as follows: Reduction in the
   heavy key fraction in the feed by 10%:

   $$T = 60 + 9.5 x_D;    0 \leq x_D \leq 0.1$${#eq-p31}

   Increase in the heavy key fraction in the feed by 10%:

   $$T = 60.1 + 11.8 x_D;    0 \leq x_D \leq 0.1$${#eq-p32}

   To ensure that that the impurity in the distillate remains within 5%, what
   would be the setpoint to the inferential tray temperature controller?
   Explain how you would determine the appropriate setpoint value.

::: {.content-visible when-format="html"}
::: {.callout-tip collapse="true"}
## Solution

```{python}

# Define range of xD (impurity fraction in distillate)
xD = np.linspace(0, 0.1, 100)

# Temperature models
T_reduction = 60 + 9.5 * xD         # Reduction in heavy key fraction by 10%
T_increase = 60.1 + 11.8 * xD       # Increase in heavy key fraction by 10%

# Plotting
plt.plot(xD, T_reduction, label="Heavy key reduced by 10%", color='#65489d')
plt.plot(xD, T_increase, label="Heavy key increased by 10%", color='#0d5e5e')

# Highlight the impurity limit (xD = 0.05)
x_limit = 0.05

t1 = 60 + 9.5 * x_limit
t2 = 60.1 + 11.8 * x_limit

# plt.axvline(x=x_limit, color='gray', linestyle='--', label=f"Impurity limit xD = {x_limit:.2f}")

plt.vlines(x=x_limit, ymin=60, ymax=61.5, 
           color='gray', ls='--', 
           label=f"Impurity limit xD = {x_limit:.2f}")

# plt.axhline(y=t1, color='gray', linestyle=':', label=f"Set point limit T = {t1:.1f}°C")

plt.hlines(y=t1, xmin=0, xmax=x_limit, 
           color='gray', ls=':', 
           label=f"Set point limit T = {t1:.1f} °C")

plt.scatter(x_limit, 60 + 9.5 * x_limit, color='#65489d')
plt.scatter(x_limit, 60.1 + 11.8 * x_limit, color='#0d5e5e')

# Acceptable range annotation
plt.annotate("acceptable range", 
             xy=(0.025, 61.25),  # midpoint of the range
             ha='center', color='#388ecc')

# Labels and title
plt.xlabel("Distillate impurity fraction, $x_D$")
plt.ylabel("Tray temperature, $T$ (°C)")
plt.xlim([0, 0.1])
plt.ylim([60, 62])
plt.yticks(np.arange(60.0, 62.01, 0.5))
plt.legend()
# plt.grid(True)

plt.show()

```

:::
:::


{{< pagebreak >}}

5. **Gain Scheduling**: 
   For the furnace shown in @fig-furnace, show a schematic control strategy
   with gain scheduling. What variable can you use for gain scheduling? Give your reasons.

::: {.content-visible when-format="html"}

![Furnace](../../../assets/images/cascade-control-in-class-furnace-temperature-control.png){#fig-furnace width=70%}

:::

::: {.content-visible unless-format="html"}

![Furnace](../../../assets/images/cascade-control-in-class-furnace-temperature-control.png){#fig-furnace}

:::


::: {.content-visible when-format="html"}
::: {.callout-tip collapse="true"}
## Solution

![Furnace gain scheduling](../../../assets/images/04-PID-enhancements-furnace-gain-scheduling.png){#fig-furnace-gain-scheduling}
:::
:::


{{< pagebreak >}}

6. A cold process fluid is heated up in a shell-and-tube heat exchanger using
   steam. At the nominal process feed flow rate, the transfer function of the
   exit temperature of the process fluid is given as follows:


   $$
   G_p = \frac{ exp (-2s)}{(5s + 1)}
   $${#eq-p5}

   It has been found that the process gain is strongly related to the process
   fluid flow rate given as follows:

   $$
   K_p = 1 + 0.5 \Delta F_p
   $${#eq-p52}

   Where, ΔF~p~ denotes the change of process fluid flow rate from its nominal
   value, i.e., $\Delta F_p = F_p - \bar{F}_p$ where $F_p$ is the current value
   of process fluid flow rate and $\bar{F}_p$ the nominal value (steady-state)
   of the process fluid flow rate.

   An ideal PI controller is given by

   $$
   G_c = K_c \left( 1 + \frac{1}{\tau_I s} \right)
   $${#eq-p53}

   Based on the PI controller tuning via the stability-based formula,

   $$
   K_c = \left( \frac{r_p}{K_p}\right) \left( \frac{\tau_p}{\theta_p}\right); 0 < r_p < 1
   $${#eq-p54}

   and 

   $$
   \tau_I = \tau_p
   $${#eq-p55}

   Assume the baseline or nominal value of the process fluid flow rate is
   $\bar{F}_p=2$, calculate the values in @tbl-p5.

   |F~p~ | K~p~ | K~c~ |
   |:-:|:-:|:-:|
   |2 (nominal)| 1 | 1.75|
   |3|1.5|1.17|
   |1|0.5|3.5|

   : Tuning parameters for problem 5 {#tbl-p5}

   Note: To calculate K~c~ a value of r~p~ = 0.7 was used. 

   Evaluate the controller performance. Simulink file for problem
   implementation without gain scheduling is given [here](./PI_without_gain_scheduler.slx).

::: {.content-visible when-format="html"}
::: {.callout-tip collapse="true"}
## Solution

[PI without gain scheduling](./PI_without_gain_scheduler.slx). 

[PI with gain scheduling](./PI_with_gain_scheduler.slx). 

:::
:::


{{< pagebreak >}}

7. **Reactor-Furnace-Distillation System**:

   For RFD system shown in @fig-rfd, draw the schematic of LS control strategy
   for the reactor system, where it is desired to control the component A (CA),
   and temperature of the reactor effluent T. The reactor temperature should
   not exceed Tmax due to the possibility of the process encountering runaway
   reaction and instability.

::: {.content-visible when-format="html"}

![Reactor-Furnace-Distillation system](../../../assets/images/reactor-furnace-distillation-system.png){#fig-rfd width=70%}

:::

::: {.content-visible unless-format="html"}

![Reactor-Furnace-Distillation system](../../../assets/images/reactor-furnace-distillation-system.png){#fig-rfd}

:::

::: {.content-visible when-format="html"}
::: {.callout-tip collapse="true"}
## Solution

![Reactor-Furnace-Distillation system low select control](../../../assets/images/04-PID-enhancements-RFD-low-select.png){#fig-rfd-low-select}
:::
:::


